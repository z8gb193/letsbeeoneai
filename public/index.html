// Core React component for BeeOneAI chat with image & YouTube support + active AIs
import React, { useState } from 'react';

const aiCharacters = {
  Nova: {
    name: 'Nova',
    intro: 'Hi, I’m Nova. Let’s grow together.',
    avatar: '/avatars/Nova.PNG',
  },
  Devlin: {
    name: 'Devlin',
    intro: 'I’m Devlin. Let’s get clear, and let’s get moving.',
    avatar: '/avatars/Devlin.PNG',
  },
  Einstein: {
    name: 'Einstein',
    intro: 'Ah! A mind at play. Let’s discover something together.',
    avatar: '/avatars/Einstein.PNG',
  },
  ChefGuru: {
    name: 'ChefGuru',
    intro: 'Hey, what’s cooking? Let’s spice things up.',
    avatar: '/avatars/ChefGuru.PNG',
  },
  BizGuru: {
    name: 'BizGuru',
    intro: 'Time to scale up — strategy, mindset, execution.',
    avatar: '/avatars/BizGuru.PNG',
  },
};

const ChatMessage = ({ message }) => {
  if (message.type === 'text') return <div className="p-2">{message.content}</div>;
  if (message.type === 'image') return <img src={message.content} alt="Shared" className="max-w-sm rounded-xl m-2" />;
  if (message.type === 'youtube') {
    const videoId = message.content.split('v=')[1]?.split('&')[0] || message.content.split('/').pop();
    return (
      <iframe
        className="m-2 rounded-xl"
        width="400"
        height="225"
        src={`https://www.youtube.com/embed/${videoId}`}
        frameBorder="0"
        allowFullScreen
        title="YouTube video"
      />
    );
  }
  return null;
};

export default function BeeOneAIChat() {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState('');
  const [activeAI, setActiveAI] = useState('Nova');

  const handlePaste = (event) => {
    const items = event.clipboardData?.items;
    if (!items) return;
    for (let item of items) {
      if (item.type.indexOf('image') !== -1) {
        const blob = item.getAsFile();
        const reader = new FileReader();
        reader.onload = (e) => setMessages((prev) => [...prev, { type: 'image', content: e.target.result }]);
        reader.readAsDataURL(blob);
      }
    }
  };

  const handleSend = () => {
    if (!input.trim()) return;
    const youtubeRegex = /(https?:\/\/(www\.)?(youtube\.com|youtu\.be)\/\S+)/gi;
    const youtubeMatch = input.match(youtubeRegex);
    if (youtubeMatch) {
      setMessages((prev) => [...prev, { type: 'youtube', content: youtubeMatch[0] }]);
    } else {
      setMessages((prev) => [...prev, { type: 'text', content: input }]);
    }
    setInput('');
  };

  return (
    <div className="p-4 max-w-2xl mx-auto">
      <div className="flex gap-2 mb-4">
        {Object.keys(aiCharacters).map((name) => (
          <button
            key={name}
            onClick={() => setActiveAI(name)}
            className={`px-3 py-1 rounded-full text-sm ${activeAI === name ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}
          >
            {aiCharacters[name].name}
          </button>
        ))}
      </div>

      <div className="flex items-center gap-3 mb-4">
        <img src={aiCharacters[activeAI].avatar} alt={activeAI} className="w-12 h-12 rounded-full" />
        <div className="text-lg font-semibold">{aiCharacters[activeAI].intro}</div>
      </div>

      <div className="border p-4 rounded-lg h-[300px] overflow-y-auto bg-white shadow-inner">
        {messages.map((msg, idx) => (
          <ChatMessage key={idx} message={msg} />
        ))}
      </div>

      <div className="mt-4">
        <textarea
          onPaste={handlePaste}
          value={input}
          onChange={(e) => setInput(e.target.value)}
          className="w-full p-2 border rounded mb-2"
          rows="3"
          placeholder="Type or paste a YouTube link, image, or message..."
        />
        <button onClick={handleSend} className="px-4 py-2 bg-blue-500 text-white rounded">
          Send
        </button>
      </div>
    </div>
  );
}

